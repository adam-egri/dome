
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
  #map { height: 100%;
	 width: 100%;
       }
</style>

<div id="map"></div>

<script>

  let data = [];
  
  fetch("https://adam-egri.github.io/dome/inaturalist-dome.csv")
    .then(response => response.text())
    .then(text => {
	const rows = text.trim().split("\n");
	
	for (let i = 1; i < rows.length; i++) {
	    
	    data.push(rows[i].replaceAll("\"", "").split(","));	  
	}
	//	      console.log(data[0][0]);

	var map = L.map('map').setView([47.481914, 19.057026], 6); // [lat, lng], zoom

	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);

	//	https://github.com/pointhi/leaflet-color-markers
	var greenIcon = new L.Icon({
	    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
	    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
	    iconSize: [25, 41],
	    iconAnchor: [12, 41],
	    popupAnchor: [1, -34],
	    shadowSize: [41, 41]
	});
	var blueIcon = new L.Icon({
	    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
	    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
	    iconSize: [25, 41],
	    iconAnchor: [12, 41],
	    popupAnchor: [1, -34],
	    shadowSize: [41, 41]
	});
	var yellowIcon = new L.Icon({
	    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',
	    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
	    iconSize: [25, 41],
	    iconAnchor: [12, 41],
	    popupAnchor: [1, -34],
	    shadowSize: [41, 41]
	});
	var orangeIcon = new L.Icon({
	    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
	    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
	    iconSize: [25, 41],
	    iconAnchor: [12, 41],
	    popupAnchor: [1, -34],
	    shadowSize: [41, 41]
	});
	
	let evirgo_markers = [];
	let plongicauda_markers = [];
	let csowerbii_markers = [];
        let pmagnifica_markers = [];

        let nevirgo = 0;
        let nplongicauda = 0;
	let ncsowerbii = 0;
        let npmagnifica = 0;
  
	for (let i = 0; i < data.length; i++) {
	    const lat = data[i][4];
	    const lon = data[i][5];
	    if (data[i][0] == "Ephoron virgo" && (data[i][7] == "CC0" || data[i][7] == "CC-BY" || data[i][7] == "CC-BY-NC")) {
		const marker = L.marker([lat, lon], {icon: yellowIcon}).addTo(map).bindPopup(`<b>Faj:</b> <i>${data[i][0]}</i><br><b>Dátum:</b> ${data[i][2]}<br><b>Megfigyelő:</b> ${data[i][6]}<br><b>Licenc:</b> ${data[i][7]}<br><a href=${data[i][8]} target="_blank"">${data[i][8]}<\a>`);
		evirgo_markers.push(marker);
                nevirgo = nevirgo + 1;
	    }
	    if (data[i][0] == "Palingenia longicauda" && (data[i][7] == "CC0" || data[i][7] == "CC-BY" || data[i][7] == "CC-BY-NC")) {
		const marker = L.marker([lat, lon], {icon: orangeIcon}).addTo(map).bindPopup(`<b>Faj:</b> <i>${data[i][0]}</i><br><b>Dátum:</b> ${data[i][2]}<br><b>Megfigyelő:</b> ${data[i][6]}<br><b>Licenc:</b> ${data[i][7]}<br><a href=${data[i][8]} target="_blank"">${data[i][8]}<\a>`);
		plongicauda_markers.push(marker);
		nplongicauda = nplongicauda + 1;
	    }
	    if (data[i][0] == "Craspedacusta sowerbii" && (data[i][7] == "CC0" || data[i][7] == "CC-BY" || data[i][7] == "CC-BY-NC")) {
		const marker = L.marker([lat, lon], {icon: blueIcon}).addTo(map).bindPopup(`<b>Faj:</b> <i>${data[i][0]}</i><br><b>Dátum:</b> ${data[i][2]}<br><b>Megfigyelő:</b> ${data[i][6]}<br><b>Licenc:</b> ${data[i][7]}<br><a href=${data[i][8]} target="_blank"">${data[i][8]}<\a>`);
		csowerbii_markers.push(marker);
		ncsowerbii = ncsowerbii + 1;
	    }
	    if (data[i][0] == "Pectinatella magnifica" && (data[i][7] == "CC0" || data[i][7] == "CC-BY" || data[i][7] == "CC-BY-NC")) {
		const marker = L.marker([lat, lon], {icon: greenIcon}).addTo(map).bindPopup(`<b>Faj:</b> <i>${data[i][0]}</i><br><b>Dátum:</b> ${data[i][2]}<br><b>Megfigyelő:</b> ${data[i][6]}<br><b>Licenc:</b> ${data[i][7]}<br><a href=${data[i][8]} target="_blank"">${data[i][8]}<\a>`);
		pmagnifica_markers.push(marker);
		npmagnifica = npmagnifica + 1;
	    }
	}

	let evirgo = L.layerGroup(evirgo_markers);
	let plongicauda = L.layerGroup(plongicauda_markers);
	let csowerbii = L.layerGroup(csowerbii_markers);
	let pmagnifica = L.layerGroup(pmagnifica_markers);

	evirgo.addTo(map);
	plongicauda.addTo(map);
	csowerbii.addTo(map);
	pmagnifica.addTo(map);
	
	var overlays = {
	    [`<b style=\"color:#CAC428;\"><i>Ephoron virgo</i> (Nll = ${nevirgo})</b>`]: evirgo,
	    [`<b style=\"color:#CB8427;\"><i>Palingenia longicauda</i> (N = ${nplongicauda})</b>`]: plongicauda,
	    [`<b style=\"color:#2A81CB;\"><i>Craspedacusta sowerbii</i> (N = ${ncsowerbii})</b>`]: csowerbii,
	    [`<b style=\"color:#2AAD27;\"><i>Pectinatella magnifica</i> (N = ${npmagnifica})</b>`]: pmagnifica
	};

	var layerControl = L.control.layers(null, overlays).addTo(map);

    })
    .catch(err => console.error("Error:", err));


</script>




